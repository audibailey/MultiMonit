{% extends "layout.html" %}

{% block head %}
    <title>Multi-Monit: Dashboard</title>
    <link rel="stylesheet" href="/static/css/dash.css"/>

    <meta http-equiv="refresh" content="{{ refresh }}">

    <script>
        $(function(){
            $("#accordion").accordion();
        });
    </script>
{% endblock %}

{% block body %}
    <div class="page-content">
        <div class="flex-grid no-responsive-future" style="height: 100%;">
            <div class="row" style="height: 100%">

                <div class="cell auto-size padding20 bg-white" id="cell-content">
                    <h1 class="text-light">Dashboard <span class="mif-meter place-right"></span></h1>
                    <hr class="bg-grayLighter">
                    <p>It is compulsory to restart MultiMonit after doing the websetup! (For logging and some other features to work)</p>
                    <br>

                    <section class="flexrow head">
                        <div class='item'>LOAD</div>
                        <div class='item'>CPU</div>
                        <div class='item'>MEMORY</div>
                        <div class='item'>SWAP</div>
                        <div class='item'>UPTIME</div>
                    </section>

                    <br>
                    <br>
                    <br>
                    <br>
                    <br>

                    <div class="accordion" id="accordion">
                        {% for i in data %}
                            <div class="frame">
                                <div class="heading">
                                    <strong>
                                        <span title="status" class="dot status {% if i.sys.status == '0' %} running {% else %} failure {% endif %}">&middot;</span>
                                        <span title="monitored" class="dot monitored {% if i.sys.monitor == '1' %} running {% else %} failure {% endif %}">&middot;</span>
                                        <a href="www.{{ i.url }}"><span class="text-light" style="color: black">{% if i.sys == 0 %}Failed to check Monit Host{% else %}{{i.sys.name }}{% endif %}</span></a>
                                    </strong>


                                    <div class="flexrow">
                                        <div class='item'>{{ i.sys.load.avg05 }}</div>
                                        <div class='item'>{{ i.sys.cpu.user }}%</div>
                                        <div class='item'>{{ i.sys.memory.percent }}%</div>
                                        <div class='item'>{% if i.sys.swap %}{{ i.sys.swap.percent }}%{% else %}N/A{% endif %}</div>
                                        <div class='item'>{{ i.sys.server.uptime}}</div>
                                    </div>
                                </div>

                                <div class="content">
                                    <div>
                                        <h3>Filesystems</h3>
                                            {% if i.fs %}
                                                <table class="table bordered">
                                                    <thead>
                                                        <tr>
                                                            <th>STATUS</th>
                                                            <th>NAME</th>
                                                            <th>USED</th>
                                                            <th>TOTAL</th>
                                                            <th>PERCENT</th>
                                                        </tr>
                                                    </thead>

                                                    <tbody>
                                                        {% for f in i.fs %}
                                                            <tr>
                                                                <td>{% if f.status == '0' %}<p style="color: green">Available</p>{% else %}<p style="color: red">Not Available</p>{% endif %}{% if f.monitor == '1' %}<p style="color: green">Monitored</p>{% else %}<p style="color: red">Not Monitored</p>{% endif %}</td>
                                                                <td>{{ f.name }}</td>
                                                                <td>{{ f.block.usage}}</td>
                                                                <td>{{ f.block.total }}</td>
                                                                <td>{{ f.block.percent}}%</td>
                                                            </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            {% else %} Not Setup {% endif %}
                                        <div class="clear"></div>
                                    </div>

                                    <div>
                                        <h3>Processes</h3>
                                        <table class="table bordered">
                                            <thead>
                                                <tr>
                                                    <th>STATUS</th>
                                                    <th>NAME</th>
                                                    <th>CPU</th>
                                                    <th>MEMORY</th>
                                                    <th>UPTIME</th>
                                                </tr>
                                            </thead>

                                            <tbody>
                                                {% for s in i.process %}
                                                    <tr>
                                                        <td>{% if s.status == '0' %}<p style="color: green">Running</p>{% else %}<p style="color: red">Not Running</p>{% endif %}{% if s.monitor == '1' %}<p style="color: green">Monitored</p>{% else %}<p style="color: red">Not Monitored</p>{% endif %}</td>
                                                        <td>{{ s.name }}</td>
                                                        <td>{% if s.cpu.percent %}{{ s.cpu.percent }}%{% else %}N/A{% endif %}</td>
                                                        <td>{% if s.mem.percent %}{{ s.mem.percent }}{% else %}N/A{% endif %}</td>
                                                        <td>{% if s.uptime %}{{ s.uptime }}{% else %}N/A{% endif %}</td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                        <div class="clear"></div>
                                    </div>

                                    <div>
                                        <h3>Hosts</h3>
                                        {% if i.host %}
                                            <table class="table bordered">
                                                <thead>
                                                    <tr>
                                                        <th>STATUS</th>
                                                        <th>NAME</th>
                                                        <th>Response Time</th>
                                                    </tr>
                                                </thead>

                                                <tbody>
                                                    {% for s in i.host %}
                                                        <tr>
                                                            <td>{% if s.status == '0' %}<p style="color: green">Running</p>{% else %}<p style="color: red">Not Running</p>{% endif %}{% if s.monitor == '1' %}<p style="color: green">Monitored</p>{% else %}<p style="color: red">Not Monitored</p>{% endif %}</td>
                                                            <td>{{ s.name }}</td>
                                                            <td>{{ s.port.responsetime }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% else %} Not Setup {% endif %}
                                        <div class="clear"></div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <div>
                        <p style="float: left">Page Resets Every {{ refresh }} Seconds </p>
                        <a href="settings" style="float: right"><span class="mif-wrench"></span> Settings</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
